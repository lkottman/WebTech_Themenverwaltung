<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>index.js - Documenting JavaScript with YUIDoc</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="Documenting JavaScript with YUIDoc" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Client side from login.html">Client side from login</a></li>
                                <li><a href="../classes/Client side from register.html">Client side from register</a></li>
                                <li><a href="../classes/client side from token.html">client side from token</a></li>
                                <li><a href="../classes/for preventing sql-injections.html">for preventing sql-injections</a></li>
                                <li><a href="../classes/Mainpage from this project.html">Mainpage from this project</a></li>
                                <li><a href="../classes/Node.js server.html">Node.js server</a></li>
                                <li><a href="../classes/routesLogin, server site processing of the Login process.html">routesLogin, server site processing of the Login process</a></li>
                                <li><a href="../classes/Server-Side from login.html">Server-Side from login</a></li>
                                <li><a href="../classes/Server-Side from token.html">Server-Side from token</a></li>
                                <li><a href="../classes/Simple database connection.html">Simple database connection</a></li>
                                <li><a href="../classes/Tests for login, register and simple functions.html">Tests for login, register and simple functions</a></li>
                                <li><a href="../classes/to change the password of a user stores it in the database..html">to change the password of a user stores it in the database.</a></li>
                                <li><a href="../classes/to generate a object for password changing.html">to generate a object for password changing</a></li>
                                <li><a href="../classes/to hash a given string and compares it afterwards.html">to hash a given string and compares it afterwards</a></li>
                                <li><a href="../classes/utility class to return parameter from url.html">utility class to return parameter from url</a></li>
                                <li><a href="../classes/.html"></a></li>
                                <li><a href="../classes/to receive mail for changing the user&#x27;s password.html">to receive mail for changing the user&#x27;s password</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/This router is for processing GETs to html files and simple GETs.html">This router is for processing GETs to html files and simple GETs</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: index.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">

/**
 * Version 1.0
 * 23.07.2020
 * AUTHOR: Created, refactored by group 1
 * @class Node.js server
 */

const express = require(&quot;express&quot;);
const session = require(&quot;express-session&quot;);
const bodyParser = require(&quot;body-parser&quot;);
const app = express();
configDatabase = require(&quot;./config/datenbankConfig.json&quot;);


var lifeTime = 1000 * 60 * 60 * 24;// 24 hour
var lifeTimeLong = 1000 * 60 * 60 * 24 * 365 * 10;  //1 Year
var tokenLifeTime = 60 * 24 * 366;// 10 + 1 day year


var {
    PORT = 3000,
    sessionLifetime = lifeTime,
    sessionName = &quot;sid&quot;,
    secretSession = &quot;test&quot;
} = process.env;

/**
 * @method
 * Express static imports for folders which are accessable from public
 */
app.use(&#x27;/css&#x27;,express.static(&#x27;./Gruppe_1_Registrierung/public/css&#x27;));
app.use(&#x27;/css&#x27;,express.static(&#x27;./css&#x27;));
app.use(&#x27;/javascript&#x27;,express.static(&#x27;./javascript&#x27;));
app.use(&#x27;/css&#x27;,express.static(&#x27;./Gruppe_1_Registrierung/private/css&#x27;));
app.use(&#x27;/images&#x27;,express.static(&#x27;./Gruppe_1_Registrierung/public/images&#x27;));
app.use(&#x27;/&#x27;,express.static(&#x27;./Gruppe_1_Registrierung/public/html&#x27;));
app.use(&#x27;/javascript&#x27;,express.static(&#x27;./Gruppe_1_Registrierung/public/javascript&#x27;));
app.use(&#x27;/javascript&#x27;,express.static(&#x27;./Gruppe_1_Registrierung/privat/javascript&#x27;));
app.use(&#x27;/privat/images&#x27;,express.static(&#x27;./Gruppe_1_Registrierung/privat/images&#x27;));

app.use(&#x27;/CSS&#x27;,express.static(&#x27;./Gruppe_5_Editor/Web Technologies/Projekt/CSS&#x27;));
app.use(&#x27;/JS&#x27;,express.static(&#x27;./Gruppe_5_Editor/Web Technologies/Projekt/JS&#x27;));
app.use(&#x27;/HTML&#x27;,express.static(&#x27;./Gruppe_5_Editor/Web Technologies/Projekt/HTML&#x27;));

//Limit sizes of json files of the server accepts
app.use(express.json({limit: &quot;10kb&quot;}));
app.use(bodyParser.urlencoded({
    extended: true
}))

/**
 * @method
 * Configuration of the cookie
 */
app.use(session({
    name: sessionName,
    resave: false,
    saveUninitialized: false,
    secret: secretSession,
    cookie: {
        maxAge: sessionLifetime,
        sameSite: true,
        secure: false    //in development in production :true
    }
}));

/**
 * AUTHOR: Dominik Dziersan
 * If the user didnt accept the cookie redirect him to the mainpage
 * @method redirectCookie
 * @param request
 * @param response
 * @param next
 */
const redirectCookie = (request, response, next) =&gt; {

    if (request.session.enabledCookies === false
    || request.session.enabledCookies === undefined) {
        response.redirect(&quot;/&quot;);
    } else {
        next();
    }
};

/**
 * AUTHOR: Dominik Dziersan
 * If a user is not logged in, redirect him to the login
 * @method redirectLogin
 * @param request
 * @param response
 * @param next
 */
const redirectLogin = (request, response, next) =&gt; {

    if (!request.session.userId) {
        response.redirect(&quot;/login&quot;)
    } else {
        next();
    }
};
/**
 * AUTHOR: Dominik Dziersan
 * If a user is logged in, redirect him to home
 * @method redirect Home
 * @param request
 * @param response
 * @param next
 */
const redirectHome = (request, response, next) =&gt; {

    if (request.session.userId) {
        response.redirect(&quot;/home&quot;);
    } else {
        next()
    }
};

/**
 * AUTHOR: Dominik Dziersan
 * For specific reasons the double request bugs some methods. Use this to prevent it.
 * @method ignoreFavicon
 * @param request
 * @param response
 * @param next
 */
function ignoreFavicon(req, res, next) {
    if (req.originalUrl === &#x27;/favicon.ico&#x27;) {
        res.status(204).json({nope: true});
        console.log(&quot;ignored&quot;);
    } else {
        console.log(&quot;next&quot;);
        next();
    }
};


/**
 * AUTHOR: Dominik Dziersan
 * Send all informations of a session to a user.
 * @method Send session every connection
 * @param request
 * @param response
 * @param next
 */
app.use((request, respond, next) =&gt; {
    const {userId} = request.session;

    respond.locals.enabledCookies = request.session.enabledCookies;


    if (userId) {
        respond.locals.userId = request.session.userId;
        respond.locals.userName = request.session.userName;
        respond.locals.userAuthorization = request.session.userAuthorization;
    }
    next();
});

/**
 * @method
 * GET Methods from routesGET.js
 */
router = require(&quot;./Gruppe_1_Registrierung/public/routes/routesGET.js&quot;);

app.get(&quot;/&quot;, router);
app.get(&quot;/login&quot;,redirectHome,redirectCookie, router);
app.get(&quot;/register&quot;,redirectHome, ignoreFavicon, redirectCookie, router);
app.get(&quot;/agb&quot;,redirectCookie, router);
app.get(&quot;/successfullregistration&quot;,redirectCookie, router);
app.get(&quot;/resetpassword&quot;, router);
app.get(&quot;/token&quot;,redirectLogin, router);
app.get(&quot;/home&quot;,redirectLogin, router);
app.get(&quot;/admin&quot;,redirectLogin, router);
app.get(&quot;/getUser&quot;,redirectLogin, router);
app.get(&quot;/confirmation&quot;, router);
app.get(&quot;/passwordforgot&quot;, router);
app.get(&quot;/register&quot;, router);
app.get(&quot;/changepassword&quot;, router);
app.get(&quot;/adminView&quot;,redirectLogin, router);
app.get(&quot;/impressum&quot;, router);
app.get(&quot;/userInfo&quot;,redirectLogin, router);
app.get(&quot;/presentation&quot;, router);
//Get without HTML|| email
app.get(&quot;/cookie&quot;, (request, response) =&gt; {
    response.json(request.session);
});


//-------------------------------------------
//Hier muss noch die routesGet angepasst werden
//-------------------------------------------
app.get(&quot;/myGroups&quot;, router);
app.get(&quot;/joinGroup&quot;, router);
app.get(&quot;/requirementsdefinition&quot;, router);

app.get(&quot;/favicon.ico&quot;, (request, response) =&gt; {
    response.writeHead(204, {&#x27;Content-Type&#x27;: &#x27;image/x-icon&#x27;} );
    response.end();
    console.log(&#x27;favicon requested&#x27;);
});
/**
 * @method
 * POST Methods
 */
routerConfirmation = require(&#x27;./Gruppe_1_Registrierung/public/routes/register/confirmMail.js&#x27;);
app.use(routerConfirmation);

routerPassword = require(&#x27;./Gruppe_1_Registrierung/public/routes/resetPassword/sendMailToChangePassword.js&#x27;);
app.use(routerPassword);

routerChangePassword = require(&#x27;./Gruppe_1_Registrierung/public/routes/resetPassword/changePassword.js&#x27;);
app.use(routerChangePassword);

routerLogin = require(&#x27;./Gruppe_1_Registrierung/public/routes/login/routesLogin.js&#x27;);
app.use(routerLogin);

routerRegister = require(&#x27;./Gruppe_1_Registrierung/public/routes/register/routesRegister.js&#x27;);
app.use(routerRegister);

routerToken = require(&quot;./Gruppe_1_Registrierung/public/routes/token/routesToken.js&quot;);
app.get(&quot;/getToken&quot;, routerToken);
app.use(routerToken);

//Gruppe 5 Editor
routerEdit = require(&quot;./Gruppe_5_Editor/Web Technologies/Projekt/routes/routesGetPostEditor.js&quot;);

app.get(&quot;/requirements&quot;,redirectLogin, routerEdit);
app.use(routerEdit);

app.post(&quot;/enableCookie&quot;, (request, response) =&gt; {
    request.session.enabledCookies = true;

    response.end();
});


app.post(&quot;/logout&quot;,  (request, respond) =&gt; {

    request.session.destroy(err =&gt; {
        if (err) {
            return respond.redirect(&quot;/home&quot;);
        }
        respond.clearCookie(sessionName);
        console.log(&quot;cookies deleted!&quot;)
        respond.redirect(&quot;/&quot;);
    })
});

// Post Methods
app.post(&quot;/index.html&quot;, redirectLogin, (request, response, next) =&gt; {
    if (request.session.userId) {
        response.redirect(&quot;/home&quot;);
    }
    next();
});


const server = app.listen(PORT, () =&gt; console.log(
    &quot;listening on: &quot; +
    &#x60;http://localhost:${PORT}&#x60;
));


module.exports = {
    server: server,
    session: session,
    redirectLogin: redirectLogin,
    redirectHome: redirectHome,
    session: session
};
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
